/**
 * 维度 2：上下文理解 (权重 20%)
 *
 * 评估 AI 是否在多轮对话中保持了上下文连贯性，
 * 能否引用前文信息、避免重复和自相矛盾。
 */
export const CONTEXT_UNDERSTANDING_PROMPT = `你是一位对话质量评估专家。请评估以下"AI 李佳琦"美妆咨询对话中，AI 的多轮上下文理解能力。

## 评估标准

1. **前文引用**：AI 是否在后续回复中引用了用户之前提供的信息？
   - 用户第1轮说"我是干皮"，后续推荐是否始终针对干皮？
   - 用户提到的过敏成分，后续推荐是否避开了？
   - 用户说的预算范围，推荐是否在范围内？

2. **信息累积**：AI 是否在多轮对话中逐步建立用户画像？
   - 是否记住了肤质、年龄、预算、偏好等已知信息？
   - 后续推荐是否基于累积的信息做出更精准的回复？

3. **矛盾检测**：AI 是否出现前后矛盾的说法？
   - 前面推荐了 A 产品，后面又否定 A？
   - 前面说某成分好，后面又说该成分有问题？

4. **重复问题**：AI 是否重复提问已知信息？
   - 用户已说过肤质，AI 是否又问"你是什么肤质"？

5. **话题切换**：用户切换话题时，AI 是否自然过渡？
   - 从面霜讨论切到防晒，过渡是否流畅？
   - 是否在新话题中仍能利用之前的上下文？

## 评分规则
- 9-10：完美利用上下文，信息累积准确，零矛盾零重复
- 7-8：大部分上下文保持良好，偶有遗漏但不矛盾
- 5-6：部分引用前文，但有明显遗漏或轻微矛盾
- 3-4：上下文保持差，频繁重复或矛盾
- 1-2：完全无视上下文，每轮回复像独立对话

## 对话记录
{conversation}

## 输出格式
请严格按以下 JSON 格式输出：
\`\`\`json
{
  "score": <1-10 的数字>,
  "reasoning": "<1-2 句中文总结评分理由>",
  "details": {
    "context_references": <AI 引用前文信息的次数>,
    "contradictions": [
      {
        "round_a": <轮次>,
        "round_b": <轮次>,
        "description": "<矛盾描述>"
      }
    ],
    "repeated_questions": <重复提问次数>,
    "topic_transitions": {
      "count": <话题切换次数>,
      "smooth_count": <自然过渡次数>
    }
  }
}
\`\`\``;
